<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Auth;
use App\Models\Package;

class AuthController extends Controller
{
    /**
     * Display the registration form
     */

    public function landingPage()
    {
        // 1. Check Authentication first (Redirect if logged in)
    if (Auth::check()) {
        $user = Auth::user();
        
        return match($user->accountType) { 'superadmin', 'admin' =>
redirect()->route('admin.dashboard'), 'client' =>
redirect()->route('client.dashboard'), default => redirect()->route('home'), };
} // 2. Calculate Most Popular Package (Only runs if user is guest) $mostPopular
= Package::select('package_name') ->selectRaw('count(*) as total')
->groupBy('package_name') ->orderByDesc('total') ->value('package_name'); // 3.
Handle "None Available" case (Default to 'Standard Package') // If $mostPopular
is null (empty table), it sets it to 'Standard Package' $mostPopular =
$mostPopular ?? 'Standard Package'; // 4. Return view with the data return
view('landingpage', compact('mostPopular')); } public function showRegister() {
if (Auth::check()) { return $this->redirectToDashboard(Auth::user()); } return
view('pages.register'); } /** * Handle registration form submission */ public
function register(Request $request) { $validated = $request->validate([ 'name'
=> 'required|string|min:3|max:255', 'email' =>
'required|email|max:255|unique:users,email', 'password' =>
'required|string|min:8|confirmed', ], [ 'name.required' => 'Please enter your
full name.', 'name.min' => 'Name must be at least 3 characters.',
'email.required' => 'Email address is required.', 'email.email' => 'Please enter
a valid email address.', 'email.unique' => 'This email is already registered.',
'password.required' => 'Password is required.', 'password.min' => 'Password must
be at least 8 characters.', 'password.confirmed' => 'Password confirmation does
not match.', ]); // Create new user (defaults to 'client' role from migration)
$user = User::create([ 'name' => $validated['name'], 'email' =>
$validated['email'], 'password' => Hash::make($validated['password']), ]);
Auth::login($user); $request->session()->regenerate(); return
$this->redirectToDashboard($user) ->with('success', 'Registration successful!
Welcome to Peaceful Rest.'); } /** * Display the login form */ public function
showLogin() { if (Auth::check()) { return
$this->redirectToDashboard(Auth::user()); } return view('pages.login'); } /** *
Handle login attempt */ public function login(Request $request) { $credentials =
$request->validate([ 'email' => 'required|email', 'password' =>
'required|string', ], [ 'email.required' => 'Email address is required.',
'email.email' => 'Please enter a valid email address.', 'password.required' =>
'Password is required.', ]); $remember = $request->boolean('remember'); if
(Auth::attempt($credentials, $remember)) { $request->session()->regenerate();
return $this->redirectToDashboard(Auth::user()) ->with('success', 'Welcome
back!'); } return back()->withErrors([ 'email' => 'The provided credentials do
not match our records.', ])->onlyInput('email'); } /** * Handle logout */ public
function logout(Request $request) { Auth::logout();
$request->session()->invalidate(); $request->session()->regenerateToken();
return redirect()->route('home') ->with('success', 'You have been logged out
successfully.'); } /** * Redirect to appropriate dashboard based on user role */
private function redirectToDashboard($user) { return match($user->accountType) {
'superadmin', 'admin' => redirect()->route('admin.dashboard'), 'client' =>
redirect()->route('client.dashboard'), default => redirect()->route('home'), };
} }
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Auth;
use App\Models\Package;

class AuthController extends Controller
{
    /**
     * Display the registration form
     */

    public function landingPage()
    {
        // 1. Check Authentication first (Redirect if logged in)
    if (Auth::check()) {
        $user = Auth::user();
        
        return match($user->accountType) { 'superadmin', 'admin' =>
redirect()->route('admin.dashboard'), 'client' =>
redirect()->route('client.dashboard'), default => redirect()->route('home'), };
} // 2. Calculate Most Popular Package (Only runs if user is guest) $mostPopular
= Package::select('package_name') ->selectRaw('count(*) as total')
->groupBy('package_name') ->orderByDesc('total') ->value('package_name'); // 3.
Handle "None Available" case (Default to 'Standard Package') // If $mostPopular
is null (empty table), it sets it to 'Standard Package' $mostPopular =
$mostPopular ?? 'Standard Package'; // 4. Return view with the data return
view('landingpage', compact('mostPopular')); } public function showRegister() {
if (Auth::check()) { return $this->redirectToDashboard(Auth::user()); } return
view('pages.register'); } /** * Handle registration form submission */ public
function register(Request $request) { $validated = $request->validate([ 'name'
=> 'required|string|min:3|max:255', 'email' =>
'required|email|max:255|unique:users,email', 'password' =>
'required|string|min:8|confirmed', ], [ 'name.required' => 'Please enter your
full name.', 'name.min' => 'Name must be at least 3 characters.',
'email.required' => 'Email address is required.', 'email.email' => 'Please enter
a valid email address.', 'email.unique' => 'This email is already registered.',
'password.required' => 'Password is required.', 'password.min' => 'Password must
be at least 8 characters.', 'password.confirmed' => 'Password confirmation does
not match.', ]); // Create new user (defaults to 'client' role from migration)
$user = User::create([ 'name' => $validated['name'], 'email' =>
$validated['email'], 'password' => Hash::make($validated['password']), ]);
Auth::login($user); $request->session()->regenerate(); return
$this->redirectToDashboard($user) ->with('success', 'Registration successful!
Welcome to Peaceful Rest.'); } /** * Display the login form */ public function
showLogin() { if (Auth::check()) { return
$this->redirectToDashboard(Auth::user()); } return view('pages.login'); } /** *
Handle login attempt */ public function login(Request $request) { $credentials =
$request->validate([ 'email' => 'required|email', 'password' =>
'required|string', ], [ 'email.required' => 'Email address is required.',
'email.email' => 'Please enter a valid email address.', 'password.required' =>
'Password is required.', ]); $remember = $request->boolean('remember'); if
(Auth::attempt($credentials, $remember)) { $request->session()->regenerate();
return $this->redirectToDashboard(Auth::user()) ->with('success', 'Welcome
back!'); } return back()->withErrors([ 'email' => 'The provided credentials do
not match our records.', ])->onlyInput('email'); } /** * Handle logout */ public
function logout(Request $request) { Auth::logout();
$request->session()->invalidate(); $request->session()->regenerateToken();
return redirect()->route('home') ->with('success', 'You have been logged out
successfully.'); } /** * Redirect to appropriate dashboard based on user role */
private function redirectToDashboard($user) { return match($user->accountType) {
'superadmin', 'admin' => redirect()->route('admin.dashboard'), 'client' =>
redirect()->route('client.dashboard'), default => redirect()->route('home'), };
} }
